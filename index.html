<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>国宝熊猫</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            background: #f5f5f5;
        }

        #player-container {
            position: relative;
            width: 100%;
            padding-bottom: 56.25%;
            background: #000;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        #video-element {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .controls {
            margin-top: 15px;
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        .control-btn {
            padding: 8px 15px;
            background: #007bff;
            border: none;
            border-radius: 4px;
            color: white;
            cursor: pointer;
            transition: background 0.3s;
        }

        .control-btn:hover {
            background: #0056b3;
        }

        .source-list {
            margin-top: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
        }

        .source-btn {
            padding: 10px;
            background: #e9ecef;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
        }

        .source-btn.active {
            background: #007bff;
            color: white;
        }

        .status-bar {
            margin-top: 10px;
            color: #666;
            font-size: 0.9em;
        }

        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            color: white;
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }

        .format-tag {
            font-size: 0.8em;
            background: #28a745;
            color: white;
            padding: 2px 5px;
            border-radius: 3px;
            margin-left: 8px;
        }
    </style>
</head>
<body>
    <div id="player-container">
        <video id="video-element" controls playsinline></video>
        <div class="loading-overlay" id="loading">加载中...</div>
    </div>

    <div class="controls">
        <button class="control-btn" id="play-pause">▶ 播放/暂停</button>
        <button class="control-btn" id="fullscreen">⤢ 全屏</button>
        <input type="range" id="volume" min="0" max="1" step="0.1" value="1">
        <span id="time-display">00:00 / 00:00</span>
    </div>

    <div class="source-list" id="source-list"></div>
    <div class="status-bar" id="status">准备就绪</div>

    <script src="https://cdn.jsdelivr.net/npm/hls.js@1.3.4/dist/hls.min.js"></script>
    <script>
        const video = document.getElementById('video-element');
        const statusDiv = document.getElementById('status');
        let hls = null;
        let currentSourceIndex = 0;
        const LOAD_TIMEOUT = 10000; // 10秒超时
        let loadTimer = null;

        // 视频源配置
        const sources = [
            { 
                name: '熊猫百科', 
                url: 'https://baikevideo.cdn.bcebos.com/media/mda-O9qJsczOmPXU0VoI/70e7c4494c555f538c18a31c5c556905.mp4',
                type: 'mp4'
            },
            { 
                name: '牧野', 
                url: 'https://gcwbndali.v.myalicdn.com/gcwbnd/xiongmao15_2/index.m3u8',
                type: 'hls'
            },
            {
	name: '苏琳',
 	url: 'https://gcwbndali.v.myalicdn.com/gcwbnd/xiongmao14_2/index.m3u8',
	type: 'hls'
            },
            {
	name: '潘旺', 
	url: 'https://gcwbndali.v.myalicdn.com/gcwbnd/xiongmao20_2/index.m3u8',
	type: 'hls'
            },
            {name: '怡然', 
	url: 'https://gcwbndali.v.myalicdn.com/gcwbnd/xiongmao12_2/index.m3u8',
	type: 'hls'
            },
            {
	name: '春雨吉福', 
	url: 'https://gcwbndali.v.myalicdn.com/gcwbnd/xiongmao18_2/index.m3u8',
	type: 'hls'
            },
            {
	name: '恩恩',
	url: 'https://gcwbndali.v.myalicdn.com/gcwbnd/xiongmao13_2/index.m3u8',
	type: 'hls'
            },
            {
	name: '一号别墅', url: 'https://gcwbndali.v.myalicdn.com/gcwbnd/xiongmao09_2/index.m3u8',
	type: 'hls'
            },
            {
	name: '六号别墅',
	url: 'https://gcwbndali.v.myalicdn.com/gcwbnd/xiongmao03_2/index.m3u8',
	type: 'hls'
            },
            {
	name: '幼儿园', 
	url: 'https://gcwbndali.v.myalicdn.com/gcwbnd/xiongmao05_2/index.m3u8',
	type: 'hls'
            },
            {
	name: '母子园', 
	url: 'https://gcwbndali.v.myalicdn.com/gcwbnd/xiongmao07_2/index.m3u8',
	type: 'hls'
            }
        ];

        // 初始化播放器
        function initPlayer(source) {
            showLoading();
            statusDiv.textContent = '正在加载...';
            clearTimeout(loadTimer);
            
            // 清理旧实例
            if (hls) {
                hls.destroy();
                hls = null;
            }

            // 设置超时检测
            loadTimer = setTimeout(() => {
                handleError({ type: 'TIMEOUT' });
            }, LOAD_TIMEOUT);

            // 根据类型初始化
            if (source.type === 'hls') {
                initHls(source.url);
            } else {
                initMp4(source.url);
            }
        }

        // 初始化HLS
        function initHls(url) {
            if (Hls.isSupported()) {
                hls = new Hls({
                    enableWorker: true,
                    autoStartLoad: true,
                    lowLatencyMode: true,
                    backBufferLength: 30
                });

                hls.loadSource(url);
                hls.attachMedia(video);

                hls.on(Hls.Events.MANIFEST_PARSED, () => {
                    handleLoadSuccess();
                    video.play().catch(handlePlayError);
                });

                hls.on(Hls.Events.ERROR, (event, data) => {
                    handleError(data);
                });
            } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                // Safari原生支持
                video.src = url;
                video.play().catch(handlePlayError);
                handleLoadSuccess();
            } else {
                handleError({ type: 'UNSUPPORTED' });
            }
        }

        // 初始化MP4
        function initMp4(url) {
            video.src = url;
            video.load();
            
            video.addEventListener('loadeddata', () => {
                handleLoadSuccess();
                video.play().catch(handlePlayError);
            });

            video.addEventListener('error', () => {
                handleError({ type: 'MP4_ERROR' });
            });
        }

        // 显示加载状态
        function showLoading() {
            document.getElementById('loading').style.display = 'flex';
        }

        // 处理加载成功
        function handleLoadSuccess() {
            clearTimeout(loadTimer);
            document.getElementById('loading').style.display = 'none';
            statusDiv.textContent = '加载成功';
        }

        // 错误处理
        function handleError(error) {
            clearTimeout(loadTimer);
            document.getElementById('loading').style.display = 'none';
            
            const errorMap = {
                'TIMEOUT': '加载超时',
                'NETWORK_ERROR': '网络错误',
                'MEDIA_ERROR': '媒体错误',
                'UNSUPPORTED': '格式不支持',
                'MP4_ERROR': 'MP4播放失败'
            };

            statusDiv.textContent = `${errorMap[error.type] || '未知错误'}，3秒后切换下一源`;
            console.error('播放错误:', error);

            // 切换源
            setTimeout(() => {
                currentSourceIndex = (currentSourceIndex + 1) % sources.length;
                document.querySelectorAll('.source-btn')[currentSourceIndex].click();
            }, 3000);
        }

        // 播放错误处理
        function handlePlayError(error) {
            statusDiv.textContent = '点击画面开始播放';
            video.muted = true;
            video.play().catch(() => {
                document.getElementById('play-pause').style.display = 'block';
            });
        }

        // 创建源按钮
        function createSourceButtons() {
            const container = document.getElementById('source-list');
            sources.forEach((source, index) => {
                const btn = document.createElement('button');
                btn.className = 'source-btn';
                btn.innerHTML = `
                    ${source.name}
                    <span class="format-tag">${source.type.toUpperCase()}</span>
                `;
                btn.onclick = () => {
                    currentSourceIndex = index;
                    document.querySelectorAll('.source-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    initPlayer(source);
                };
                container.appendChild(btn);
            });
            
            // 默认加载第一个源
            if (sources.length > 0) {
                container.querySelector('.source-btn').click();
            }
        }

        // 播放控制
        document.getElementById('play-pause').addEventListener('click', () => {
            video.paused ? video.play() : video.pause();
        });

        // 全屏控制
        document.getElementById('fullscreen').addEventListener('click', () => {
            if (video.requestFullscreen) {
                video.requestFullscreen();
            } else if (video.webkitRequestFullscreen) {
                video.webkitRequestFullscreen();
            }
        });

        // 音量控制
        document.getElementById('volume').addEventListener('input', (e) => {
            video.volume = e.target.value;
        });

        // 时间显示
        video.addEventListener('timeupdate', () => {
            const format = (sec) => {
                const min = Math.floor(sec / 60);
                return `${String(min).padStart(2, '0')}:${String(Math.floor(sec % 60)).padStart(2, '0')}`;
            };
            document.getElementById('time-display').textContent = 
                `${format(video.currentTime)} / ${format(video.duration)}`;
        });

        // 初始化
        createSourceButtons();
        video.crossOrigin = 'anonymous';

        // 网络恢复自动重试
        window.addEventListener('online', () => {
            if (video.paused) {
                initPlayer(sources[currentSourceIndex]);
            }
        });
    </script>
</body>
</html>
